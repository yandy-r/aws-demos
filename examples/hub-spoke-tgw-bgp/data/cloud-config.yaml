#cloud-config
# Add groups to the system
# Adds the ubuntu group with members 'root' and 'sys'
# and the empty group hashicorp.
groups:
  - cloud-users: [root, sys]

# Add users to the system. Users are added after groups are added.
users:
  - default
  - name: cloud-user
    gecos: cloud-user
    shell: /bin/bash
    primary_group: cloud-users
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: users, admin
    lock_passwd: false
    ssh_authorized_keys:
      - ${public_ssh_key}

preserve_hostname: false
hostname: ${hostname}

write_files:
  - encoding: b64
    content: ${private_ssh_key}
    owner: cloud-user:cloud-users
    path: /home/cloud-user/.ssh/${ssh_key_name}
    permissions: '0600'

# Downloads the golang package
packages:
  - golang-go

# Sets the GOPATH & downloads the demo payload
runcmd:
  - sudo su cloud-user
  - sudo mkdir /home/cloud-user/go
  - sudo chown cloud-user:cloud-users /home/cloud-user/go
  - export GOPATH=/home/cloud-user/go
